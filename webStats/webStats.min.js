/*! 
 * web 性能统计
 * Usage: WEBSTATS.getWebInfo(callback(data));
 * Version: 1.1.2
 **/
(function(){var n={},t={};n.performance=window.performance||window.webkitPerformance||window.msPerformance;n.isReady=!1;n.cacheFn=[];n.performanceData={unit:"ms",system:"",ua:"",url:"",loadPage:0,domReady:0,redirect:0,lookupDomain:0,TTFB:0,request:0,loadEvent:0,appcache:0,unloadEvent:0,network:0,domActive:0,blank:0,tcp:0,tcpSSL:0,total:0,resource:[]};n.getResourceInfo=function(n){for(var u=[],i=0;i<n.length;i++){var t=n[i],f=new URL(t.name),r={};r={name:f.pathname,fetchStart:t.fetchStart,href:f.href,type:t.initiatorType,duration:t.duration};typeof t.transferSize!="undefined"&&(r.size=t.transferSize/1024+"KB");u.push(r)}return u.sort(function(n,t){return t.duration-n.duration})};n.getWebInfo=function(t){var o,e,i;if(!n.isReady)return n.cacheFn.push(t),n.ready();var f=navigator.userAgent,h=f.match(/(ipod).*\s([\d_]+)/i),c=f.match(/(ipad).*\s([\d_]+)/i),l=f.match(/(iphone)\sos\s([\d_]+)/i),a=f.match(/(android)\s([\d\.]+)/i),u="Unknown",s="",r=n.performanceData;a?u="Android "+a[2]:l?u="iPhone, iOS "+l[2].replace(/_/g,"."):c?u="iPad, iOS "+c[2].replace(/_/g,"."):h&&(u="iPod, iOS "+h[2].replace(/_/g,"."));s=u;o=f.match(/MicroMessenger\/([\d\.]+)/i);o&&o[1]&&(u=o[1],s+=", WeChat "+u);r.ua=f;r.system=s;r.url=window.location.href;e=n.performance;e&&(i=e.timing,i.loadEventEnd>0&&(i.loadEventEnd&&i.navigationStart&&(r.loadPage=i.loadEventEnd-i.navigationStart),i.domComplete&&i.responseEnd&&(r.domReady=i.domComplete-i.responseEnd),i.redirectEnd&&i.redirectStart&&(r.redirect=i.redirectEnd-i.redirectStart),i.domainLookupEnd&&i.domainLookupStart&&(r.lookupDomain=i.domainLookupEnd-i.domainLookupStart),i.responseStart&&i.navigationStart&&(r.TTFB=i.responseStart-i.navigationStart),i.responseEnd&&i.responseStart&&(r.request=i.responseEnd-i.responseStart),i.loadEventEnd&&i.loadEventStart&&(r.loadEvent=i.loadEventEnd-i.loadEventStart),i.domainLookupStart&&i.fetchStart&&(r.appcache=Math.max(i.domainLookupStart-i.fetchStart,0)),i.unloadEventEnd&&i.unloadEventStart&&(r.unloadEvent=i.unloadEventEnd-i.unloadEventStart),i.responseEnd&&i.navigationStart&&(r.network=i.responseEnd-i.navigationStart),i.domInteractive&&i.navigationStart&&(r.domActive=i.domInteractive-i.navigationStart),i.responseEnd&&i.navigationStart&&(r.blank=i.responseEnd-i.navigationStart),i.connectEnd&&i.connectStart&&(i.connectEnd&&i.secureConnectionStart&&(r.tcpSSL=i.connectEnd-i.secureConnectionStart),r.tcp=i.connectEnd-i.connectStart),(i.loadEventEnd||i.loadEventStart||i.domComplete||i.domLoading)&&i.navigationStart&&(r.total=(i.loadEventEnd||i.loadEventStart||i.domComplete||i.domLoading)-i.navigationStart),e.getEntriesByType&&(r.resource=e.getEntriesByType("resource"),r.resourceFormat=n.getResourceInfo(r.resource)),r.timing=i));t&&t(r)};n.ready=function(){clearInterval(t);t=setInterval(function(){n.performance.timing.loadEventEnd>0&&(clearInterval(t),n.isReady=!0,n.getWebInfo(function(t){for(var r,i=0;i<n.cacheFn.length;i++)r=n.cacheFn[i],r&&r(t);n.cacheFn=[]}))},100)};window.WEBSTATS=n})();